<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
  <title>Shadow</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&display=swap">
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
</head>
<body>

  <div id="loading-screen">
    <div class="dot-container">
    <i class="loading-dots"><i class="fa-solid fa-circle"></i></i>
    <i class="loading-dots"><i class="fa-solid fa-circle"></i></i>
    <i class="loading-dots"><i class="fa-solid fa-circle"></i></i> <br> <br>
    </div>
    <p class="loading-text">Loading Shadow Browser</p>
  </div>

  
  <div id="tabs-container">
    <button id="add-tab" class="control-button" style="font-size: 15px; height:fit-content;margin-top: 7.5px;"><i class="fas fa-plus"></i></button>
  </div>
  
  <div id="header">
    <button id="back-button" class="control-button"><i class="fas fa-arrow-left"></i></button>
    <button id="forward-button" class="control-button"><i class="fas fa-arrow-right"></i></button>
    <button id="refresh-button" class="control-button"><i class="fas fa-redo"></i></button>
    <form id="uv-form" class="inputcontainermain">
      <input type="text" id="search-bar" placeholder="Search or enter a URL">
      <input id="uv-search-engine" value="https://www.google.com/search?q=%s" type="hidden"/>
    </form>
    <div id="menu-button" class="control-button" style="margin-left: 15px;  font-size: 24px;">&#8801;</div>
  </div>
  <div id="context-menu" class="context-menu" style="display:none;">
    <ul>
      <li data-action="edit">Edit Bookmark</li>
      <li data-action="delete">Delete Bookmark</li>
    </ul>
  </div>
  <div id="edit-panel" class="edit-panel">
    <h2>Edit Bookmark</h2>
    <input type="text" id="edit-title" placeholder="Title" />
    <input type="text" id="edit-url" placeholder="URL" />
    <button id="edit-save">Save</button>
  </div>
  
  
  <div id="myDropdown" class="dropdown-content" style="display:none">
      <table>
        <tr>
          <td><button data-add-tab><i class="fas fa-plus"></i> New tab</button></td>
        </tr>
      </table>
      <table>
        <tr>
          <td><button data-add-tab><i class="fas fa-plus"></i> Add Boomark </button></td>
        </tr>
      </table>
    <div class="separator"></div>
    <table>
      <tr>
        <td><button data-add-tab><i class="fas fa-history"></i> History</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab onclick='createTab("Settings", "/settings");'><i class="fas fa-cog"></i> Settings</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab><i class="fas fa-question-circle"></i> Help</button></td>
      </tr>
    </table>
    <div class="separator"></div>
    <table>
      <tr>
        <td><button data-add-tab><i class="fas fa-expand-arrows-alt"></i> Fullscreen</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab><i class="fas fa-sign-out-alt"></i>Open About:Blank</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab><i class="fas fa-sign-out-alt"></i>Open Tab in Abt:Blank</button></td>
      </tr>
    </table>
    <table>
      <tr>
        <td><button data-add-tab><i class="fa-solid fa-circle-xmark"></i> Exit</button></td>
      </tr>
    </table>
  </div>

  <div id="bookmarks-container"></div>  
  <div id="iframes-container"></div>
  <div class="desc left-margin">
    <p id="uv-error"></p>
    <pre id="uv-error-code"></pre>
  </div>
  <script src="script.js" async></script>
  <script src="/assets/themes.js"></script>
  <script src="/uv/uv.bundle.js" ></script>
  <script src="/uv/uv.config.js" ></script>
  <script src="/uv/uv.sw.js" ></script>
  <script src="/uv/uv.config.js" ></script>
  <script src="/register-sw.js" ></script>
  <script src="/assets/search.js" ></script>
</body>
</html>

<script>
window.onload = function() {
  const maxBookmarks = 20; // Maximum number of bookmarks
  const addBookmarkButton = document.querySelector(".bookmark.add");
  const modal = document.getElementById("bookmark-modal");
  const closeBookmarkModal = document.querySelector(".close-bookmark");
  addBookmarkButton.addEventListener("click", () => {
    modal.style.display = "block";
  });
  closeBookmarkModal.addEventListener("click", () => {
    modal.style.display = "none";
  });
  window.addEventListener("click", (event) => {
    if (event.target === modal) {
      modal.style.display = "none";
    }
  });

  const addBookmark = document.getElementById("add-bookmark");
  const bookmarkName = document.getElementById("bookmark-name");
  const bookmarkUrl = document.getElementById("bookmark-url");
  const bookmarkForm = document.getElementById("bookmark-form");
  const bookmarksContainer = document.querySelector(".bookmarks");

  modal.addEventListener("click", function (event) {
    if (event.target === addBookmark) {
      if (bookmarksContainer.querySelectorAll(".bookmark").length >= maxBookmarks) {
        alert("You've reached the maximum number of bookmarks (20). Please delete some bookmarks to add new ones.");
        return;
      }
      const name = bookmarkName.value;
      const url = bookmarkUrl.value;
      if (name && url) {
        const newBookmark = document.createElement("a");
        newBookmark.className = "bookmark";
        const domain = url;
        const size = 64;
        const imgSrc = `https://www.google.com/s2/favicons?domain=${domain}&sz=${size}`;
        newBookmark.innerHTML = `
          <img src="${imgSrc}">
          <p>${name}</p>
        `;
        newBookmark.setAttribute("data-url", url);
        bookmarksContainer.insertBefore(newBookmark, addBookmarkButton);
        const bookmarks = JSON.parse(localStorage.getItem("bookmarks")) || [];
        bookmarks.push({ name, url });
        localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
        modal.style.display = "none";
        bookmarkForm.reset();
      }
    }
  });

  function loadBookmarks() {
    const bookmarks = JSON.parse(localStorage.getItem("bookmarks")) || [];
    bookmarks.slice(0, maxBookmarks).forEach((bookmark) => {
      const { name, url } = bookmark;
      const newBookmark = document.createElement("a");
      newBookmark.className = "bookmark";
      const domain = url;
      const size = 64;
      const imgSrc = `https://www.google.com/s2/favicons?domain=${domain}&sz=${size}`;
      newBookmark.innerHTML = `
        <img src="${imgSrc}">
        <p>${name}</p>
      `;
      newBookmark.setAttribute("data-url", url);
      bookmarksContainer.insertBefore(newBookmark, addBookmarkButton);
    });
  }

  loadBookmarks();
  const bookmarkContextMenu = document.getElementById("bookmark-context-menu");
  let selectedBookmark;
  bookmarksContainer.addEventListener("contextmenu", (event) => {
    event.preventDefault();
    const bookmark = event.target.closest(".bookmark");
    if (bookmark && bookmark !== addBookmarkButton) {
      selectedBookmark = bookmark;
      bookmarkContextMenu.style.left = `${event.pageX}px`;
      bookmarkContextMenu.style.top = `${event.pageY}px`;
      bookmarkContextMenu.style.display = "block";
    }
  });

  document.addEventListener("click", () => {
    bookmarkContextMenu.style.display = "none";
  });

  document.getElementById("edit-bookmark-context-menu-option").addEventListener("click", () => {
    bookmarkContextMenu.style.display = "none";
    const name = selectedBookmark.querySelector("p").textContent;
    const url = selectedBookmark.getAttribute("data-url");
    const imgSrc = `https://www.google.com/s2/favicons?domain=${url}&sz=64`;
    const editBookmarkModal = document.getElementById("edit-bookmark-modal");
    const editBookmarkNameInput = document.getElementById("edit-bookmark-name");
    const editBookmarkUrlInput = document.getElementById("edit-bookmark-url");
    editBookmarkNameInput.value = name;
    editBookmarkUrlInput.value = url;
    editBookmarkModal.style.display = "block";
    document.getElementById("edit-bookmark").addEventListener("click", () => {
      selectedBookmark.querySelector("p").textContent = editBookmarkNameInput.value;
      const newURL = editBookmarkUrlInput.value;
      selectedBookmark.setAttribute("data-url", newURL);
      const newImgSrc = `https://www.google.com/s2/favicons?domain=${newURL}&sz=64`;
      selectedBookmark.querySelector("img").src = newImgSrc;
      const bookmarks = JSON.parse(localStorage.getItem("bookmarks")) || [];
      const selectedBookmarkIndex = bookmarks.findIndex(
        (bookmark) => bookmark.name === name
      );
      if (selectedBookmarkIndex !== -1) {
        bookmarks[selectedBookmarkIndex] = {
          name: editBookmarkNameInput.value,
          url: newURL,
        };
        localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
      }
      editBookmarkModal.style.display = "none";
    });
  });

  document.getElementById("close-edit-bookmark").addEventListener("click", () => {
    const editBookmarkModal = document.getElementById("edit-bookmark-modal");
    editBookmarkModal.style.display = "none";
  });

  document.getElementById("delete-bookmark-context-menu-option").addEventListener("click", () => {
    bookmarkContextMenu.style.display = "none";
    if (selectedBookmark !== addBookmarkButton) {
      selectedBookmark.remove();
      const name = selectedBookmark.querySelector("p").textContent;
      const bookmarks = JSON.parse(localStorage.getItem("bookmarks")) || [];
      const updatedBookmarks = bookmarks.filter(
        (bookmark) => bookmark.name !== name
      );
      localStorage.setItem("bookmarks", JSON.stringify(updatedBookmarks));
    }
  });
}

</script>